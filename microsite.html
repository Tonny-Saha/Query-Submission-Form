<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="app.js"></script>
    <title>Querry Submission Form</title>
</head>
<body>
    <div class="wrapper">
        <div class="container main">
            <div class="row">
                <div class="col-md-6 side-image">
                    <div class="text">
                        <h3>Querry Submission Form</h3>
                    </div>
                    
                </div>
                <div class="col-md-6 right">
                    
                   <form action="" class="form">
                    <div class="input-box">
                        
                         <div class="input-field">
                            <input type="text" class="input" id="name" name="name" required="" autocomplete="off" >
                            <label for="name">Name <span>*</span></label>
                        </div>
                        
                        <div class="input-field">
                          <input type="tel" class="input" id="phone" name="phone" required="" maxlength="14" autocomplete="off" value="+880">
                           <label for="phone">Phone Number</label>
                        </div>

                        <div class="subject-dropdown">
                            <label for="subject">Subject <span>*</span></label> <br>
                            <input type="checkbox" id="q1" name="subject" value="Question : সিমেন্টের দাম জানতে চাই" >
                            <label for="option1" class="subject"> &nbsp; সিমেন্টের দাম জানতে চাই </label><br>
                            <input type="checkbox" id="q2" name="subject" value="Question : সিমেন্ট সম্পর্কে জানতে চাই">
                            <label for="option2"> &nbsp; সিমেন্ট সম্পর্কে জানতে চাই </label><br>
                            <input type="checkbox" id="q3" name="subject" value="Question : কোথা থেকে কিনব?">
                            <label for="option3"> &nbsp; কোথা থেকে কিনব? </label><br>
                            <input type="checkbox" id="q4" name="subject" value="Question : বিক্রয় প্রতিনিধির সাথে কথা বলতে চাই ">
                            <label for="option4"> &nbsp; বিক্রয় প্রতিনিধির সাথে কথা বলতে চাই </label>
                        </div>
                        
                         <div class="input-field">
                            <label for="query">Detail Query ( আপনার প্রশ্নটি বিস্তারিত লিখুন )</label>
                            <br> <br>
                            <textarea id="query" name="query"></textarea>
                        </div>
                         <div class="dropdown">
                            <label for="district" class="district-class">District <span>*</span></label>
                             <br>
                            <input type="text" id="searchInput" oninput="getDistricts()" onkeydown="handleKeyDown(event)" placeholder="Type to search" class="district">
                            <div class="dropdown-content" id="dropdownContent"></div>
                          </div>

                          <!-- Thana -->
                         
                         <div class="input-field" id="thanaContainer">
                             <label for="thana">Thana <span>*</span></label>
                             <br> <br>
                             <select id="thanaDropdownContent" class="dropdown-content">
                              <option value="">Select Thana</option>
                            </select>

                         </div>

                        <div class="btn-group">
                            <div class="input-field">
                             <input type="submit" class="submit" value="Submit">
                        </div> 
                   
                             <div class="input-field">
                             <input type="reset" class="reset" value="Reset the form">
                        </div> 
                         </div>
                 
                     </div> 
                   </form> 
                </div>
            </div>
        </div>
    </div>
<script >

   document.addEventListener('DOMContentLoaded', function() {
    var phoneInput = document.getElementById("phone");
    
    // Initialize the value of the input field with +880
    phoneInput.value = "+880";

    // Set cursor position after "+880" when input field gets focus
    phoneInput.addEventListener("focus", function(event) {
        if (phoneInput.setSelectionRange) {
            phoneInput.setSelectionRange(4, 4);
        }
    });

    // Prevent user from editing the prefix part
    phoneInput.addEventListener("input", function(event) {
        if (phoneInput.value.indexOf("+880") !== 0) {
            phoneInput.value = "+880" + phoneInput.value.substring(4);
        }
    });
   // Prevent user from typing non-numeric characters
   phoneInput.addEventListener("keydown", function(event) {
                // Allow backspace, delete, left arrow, right arrow, home, and end keys
                if (event.key === "Backspace" || event.key === "Delete" || event.key === "ArrowLeft" || event.key === "ArrowRight" || event.key === "Home" || event.key === "End") {
                    return;
                }
                // Allow only numeric characters
                if (!/[0-9]/.test(event.key)) {
                    event.preventDefault();
                }
            });
            // Validate phone number when focus moves away from the input field
  phoneInput.addEventListener("blur", function(event) {

                if(phoneInput.value.length !== 14){
                    alert("Phone number should be 11 digits long.");
                }else{
                    // console.log("Hello");
                }
                
                var regex = /^(\+880)?(13|14|15|16|17|18|19)\d{8}$/;
                if (!regex.test(phoneInput.value) && phoneInput.value.length == 14 ) {
                    alert("Invalid phone number. Valid Phone Number Examples: 013, 014, 015, 016, 017, 018, 019");
                    console.log(phoneInput.value.length)}
                else{
                    // console.log("Hello");
                }
            });


});

</script>

<script>
  let dropdownOptions = [];
  let selectedIndex = -1;

  function handleKeyDown(event) {
      const dropdownContent = document.getElementById('dropdownContent');
      const options = dropdownContent.querySelectorAll('a');

      if (event.key === 'ArrowDown') {
          event.preventDefault();
          if (selectedIndex < dropdownOptions.length - 1) {
              selectedIndex++;
              updateSelectedOption(options);
          }
      } else if (event.key === 'ArrowUp') {
          event.preventDefault();
          if (selectedIndex > 0) {
              selectedIndex--;
              updateSelectedOption(options);
          }
      } else if (event.key === 'Enter') {
          event.preventDefault();
          if (selectedIndex !== -1) {
              const selectedOption = options[selectedIndex];
              document.getElementById('searchInput').value = selectedOption.textContent;
              dropdownContent.style.display = 'none';
              const districtId = selectedOption.getAttribute('data-id');
              handleDistrictSelection(districtId, selectedOption.textContent);
          }
      }
  }

  function updateSelectedOption(options) {
      options.forEach(option => {
          option.classList.remove('active');
      });

      if (selectedIndex !== -1) {
          options[selectedIndex].classList.add('active');
      }
  }

  async function getDistricts() {
      const searchInput = document.getElementById('searchInput').value.toLowerCase();
      const dropdownContent = document.getElementById('dropdownContent');
      dropdownContent.innerHTML = ''; // Clear previous suggestions
      dropdownOptions = []; // Clear previous dropdown options

      try {
          const response = await fetch("https://salesforcedev.bergerbd.com/api/district/getAllDistricts");
          const data = await response.json();

          if (!data || !Array.isArray(data.result)) {
              console.error('Unexpected data format:', data);
              return;
          }

          const districts = data.result;
          const filteredDistricts = districts.filter(district => district.name.toLowerCase().includes(searchInput));

          dropdownContent.innerHTML = ''; // Clear previous dropdown options
          dropdownOptions = [];

          filteredDistricts.forEach(district => {
              dropdownOptions.push(district.name);
              const option = createDropdownOption(district);
              dropdownContent.appendChild(option);
          });

          dropdownContent.style.display = filteredDistricts.length > 0 ? 'block' : 'none';
      } catch (error) {
          console.error('Error fetching data:', error);
      }
  }

  async function getThanasByDistrictId(districtId) {
      const thanaDropdown = document.getElementById('thanaDropdownContent');
      thanaDropdown.innerHTML = '<option value="">Select Thana</option>';
      console.log(districtId);
      try {
          const response = await fetch(`https://salesforcedev.bergerbd.com/api/thana/getAllThanaByDistrictId/${districtId}`);
          const data = await response.json();

          if (!data || !data.result || !Array.isArray(data.result.thanaResponse)) {
              console.log('No data found for this District');
              return;
          }

          const thanas = data.result.thanaResponse;

          thanas.forEach(thana => {
              const option = document.createElement('option');
              option.value = thana.id;
              option.textContent = thana.name;
              thanaDropdown.appendChild(option);
          });

          thanaDropdown.style.display = 'block';
      } catch (error) {
          console.error('Error fetching thana data:', error);
      }
  }

  function handleDistrictSelection(districtId, districtName) {
      document.getElementById('searchInput').value = districtName;
      getThanasByDistrictId(districtId);
  }

  function createDropdownOption(district) {
      const option = document.createElement('a');
      option.textContent = district.name;
      option.setAttribute('data-id', district.id);
      option.addEventListener('click', handleSelection);
      return option;
  }

  function handleSelection() {
      const districtId = this.getAttribute('data-id');
      const districtName = this.textContent;
      handleDistrictSelection(districtId, districtName);
      hideDropdown();
  }

  function hideDropdown() {
      const dropdownContent = document.getElementById('dropdownContent');
      dropdownContent.style.display = 'none';
  }

  document.getElementById('searchInput').addEventListener('input', getDistricts);
  document.addEventListener('keydown', handleKeyDown);

  // Event listener to hide dropdown when clicking outside of it
  document.addEventListener('click', function(event) {
      const dropdownContent = document.getElementById('dropdownContent');
      if (!dropdownContent.contains(event.target)) {
          hideDropdown();
      }
  });
</script>
 
</body>
</html>